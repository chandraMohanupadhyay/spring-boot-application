pipeline {
    agent any

    stages {

        stage ('checkout'){
            steps {
                echo 'checking in git...'
            git 'https://github.com/chandraMohanupadhyay/spring-boot-application.git'
            }  
        }
        
        stage ('compile'){
            steps {
                sh 'mvn compile'
            }
        }

        stage ('test'){
            steps {
                sh 'mvn test'
            }
        }

        stage ('build'){
            steps {
                sh 'mvn package'
            }
        }

        stage ('build image'){
            steps {
                sh 'docker build -t springboot:$BUILD_NUMBER .'
                sh 'docker tag springboot:$BUILD_NUMBER chandramohanupadhyay/springboot:$BUILD_NUMBER'
            }
        }

        stage('push image'){
            steps {
                withDockerRegistry([ credentialsId: "dockerhub", url: "" ])
			    {
			       sh 'docker push jsachdev07/addressbook:$BUILD_NUMBER'
			    }
            }
        }

        stage('Deploy as container')
		{
			steps
			{
				sh 'docker run -itd -P jsachdev07/addressbook:$BUILD_NUMBER'
			}
		}

    }
}